#!/bin/bash

# ⚡
[ $# -eq 0 ] && bat=$(acpi -b | rg -o '[0-9]+%') || bat=$1
bat=${bat%?}

full=$(( bat*20/100 ))

if [ "$bat" -ne 100 ]; then
    full=$(( full+1 ))
fi
empty=$(( 20-full ))

message="[BAT $bat%]"
messagelen=${#message}
if [ "$full" -gt "$messagelen" ]; then
    full=$(( full-messagelen ))
    fs="$message"
else
    fullen=$full
    full=0
    empty=$(( empty-(messagelen-fullen) ))
    fs=${message:0:$fullen}
    es=${message:$fullen}
fi

while [ "$full" -ne 0 ] ; do
    fs="$fs"' '
    full=$(( full-1 ))
done

while [ "$empty" -ne 0 ] ; do
    es="$es"' '
    empty=$(( empty-1 ))
done

if acpi -b | rg -q "Charging"; then
    if [ -n "$es" ]; then
        eslen=${#eslen}
        eslen=$(( eslen-1 ))
        es=${es:0:$eslen}'⚡'
    else
        fslen=${#fslen}
        fslen=$(( fslen-1 ))
        fs=${fs:0:$fslen}'⚡'
    fi
fi

echo "$es" >"$XDG_RUNTIME_DIR"/bempt
echo "$fs" >"$XDG_RUNTIME_DIR"/bfull
echo "$fs" >>"$XDG_RUNTIME_DIR"/bfull
echo "#04060a" >>"$XDG_RUNTIME_DIR"/bfull
if [ "$bat" -le 20 ] 
then
    echo "#d43f3f" >>"$XDG_RUNTIME_DIR"/bfull
else
    echo "#b3bf3b" >>"$XDG_RUNTIME_DIR"/bfull
fi

pkill -SIGRTMIN+12 i3blocks

exit 0
