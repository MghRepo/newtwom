#!/bin/sh

bat=$(acpi -b | rg -o '[0-9]+%')
val=${bat%?}
full=$(( $val*20/100 ))

if [ $val -ne 100 ]
then
    full=$(( $full+1 ))
else
    empty=0
fi
empty=$(( 20-$full ))
message="[BAT $bat]"
if [ $full -ge 9 ]
then
    fullen=9
    full=$(( $full-9 ))
else
    fullen=$full
    full=0
fi
fs=${message:0:$fullen}
es=${message:$fullen}
while [ $full -ne 0 ] ; do
    fs+=' '
    full=$(( $full-1 ))
done

while [ $empty -ne 0 ] ; do
    es+=' '
    empty=$(( $empty-1 ))
done

echo "$es" >$XDG_RUNTIME_DIR/bempt
echo "$fs" >$XDG_RUNTIME_DIR/bfull
echo "$fs" >>$XDG_RUNTIME_DIR/bfull
echo "#04060a" >>$XDG_RUNTIME_DIR/bfull
if [ ${bat%?} -le 20 ] 
then
    echo "#d43f3f" >>$XDG_RUNTIME_DIR/bfull
else
    echo "#b3bf3b" >>$XDG_RUNTIME_DIR/bfull
fi

pkill -SIGRTMIN+12 i3blocks

exit 0
